COMMENT ⊗   VALID 00007 PAGES 
RECORD PAGE   DESCRIPTION
 00001 00001
 00002 00002	SUBTTL DATA AREA FOR INTERMINABLE MESSAGE PROTESTOR - JAM SEPT, '71
 00003 00003	 MODEL DEVICE DATA BLOCK FOR IMP CONNECTIONS
 00005 00004	 OUTPUT ROUTINE STORAGE
 00008 00005	 STORAGE FOR CLOCK LEVEL WAIT ROUTINE
 00010 00006	 HOST AND LINK TABLES
 00012 00007	 THE FOLLOWING ARE COUNTERS OF THE NUMBER OF TIMES VARIOUS EVENTS HAVE HAPPENED
 00016 ENDMK
⊗;
SUBTTL DATA AREA FOR INTERMINABLE MESSAGE PROTESTOR - JAM SEPT, '71
; MODEL DEVICE DATA BLOCK FOR IMP CONNECTIONS

DEFINE Z(NAME,VAL) <NAME←←.-DDBMDL ↔ VAL>

	DEVSHR,,0		; DEVCMR
DDBMDL:	SIXBIT /IMP/
	TDLEN+1			; DEVCHR, BUFFER SIZE
	0			; DEVIOS
	LPTDDB,,IMPDSP		; DEVSER, UUO DISPATCH TABLE ADDRESS
	DVIMP!DVLNG!DVIN!DVOUT,,154403
	0			; DEVLOG
	0			; DEVBUF
	0			; DEVIAD
	0			; DEVOAD
	0			; DEVFIL
	0			; DEVEXT
	Z(INL,0)		; INPUT LIST
	Z(MAL,0)		; MESSAGE ALLOCATION
	Z(BAL,0)		; BIT ALLOCATION
	Z(NHMA,0)		; NOMINAL MESSAGE ALLOCATION
	Z(NHBA,0)		; NOMINAL BIT ALLOCATION
	Z(NHMA2,0)		; 1/2 OF THE NOMINAL MESSAGE ALLOCATION
	Z(NHBA2,0)		; 1/2 OF THE NOMINAL BIT ALLOCATION
	Z(HMA,0)		; HIS MESSAGE ALLOCATION
	Z(HBA,0)		; HIS BIT ALLOCATION
	Z(MIIL,0)		; NUMBER OF MESSAGES IN INPUT LIST
	Z(BIIL,0)		; NUMBER OF BITS IN INPUT LIST
	Z(TIMES,<BYTE (6) 5,5,0,40,0>)
				; CLS, RFNM, ALL, RFC, INP WAIT TIMEOUTS
	Z(TIM,-1)		; TIMEOUT COUNT
IMPDLN←←.-DDBMDL+1

IMPDIE:		0	; SET TO NON-ZERO TO KEEP IMP SYSTEM DOWN

IMPST←←.		; NOTE IMP DATA AREA TO BE CLEARED BEGINS HERE
; OUTPUT ROUTINE STORAGE

IMPDEAD:	0	; SET TO -1 IF IMP DECLARED DEAD
IMPOACT:	0	; SET TO -1 IF OUTPUT IS ACTIVE
IMPOBK:		0	; OUTPUT BLKO POINTER
IMPOCUR:	0	; CURRENT BUFFER BEING OUTPUTTED
OLIST:		0	; OUTPUT LIST. XWD <LAST ELEMENT>,<FIRST ELEMENT>
IMPOFC:		0	; COUNT OF WDS TO GO IN 36B MODE
IMPOFM:		0	; SET TO -1 FOR FULL WORD (36B) MODE
IMPOCT:		0	; OUTPUT TIME-OUT COUNT
IMPOPD:		0	; OUTPUT SIDE PUSHDOWN LIST
IMPOPL:		BLOCK INTPLN

; INPUT ROUTINE STORAGE

IMPBKO:		0	; INPUT BLKI WORD
IMPICUR:	0	; CURRENT INPUT BUFFER
IMPITOP:	0	; TOP OF CURRENT INPUT LIST
ILIST:		0	; INPUT LIST, XWD <LAST ELEMENT>,<FIRST ELEMENT>
IMPIFM:		0	; -1 FOR 36B MODE, OTHERWISE, 32B MODE
IMPHELP:	0	; IF NO BUFFER AVAILABLE AT I-LEVEL, INPUT WORD IS PLACED HERE
IMPHLF:		0	; FLAG THAT SAYS WE ARE WAITING FOR AN INPUT BLOCK
IMPIHD:		0	; SET TO -1 IF WORD IN IMPHELP IS LAST WORD IN MESSAGE
IMPSPARE:	0	; SPARE INPUT BUFFER
IMPCLN:		0	; SET TO -1 WHEN A CLOCK REQUEST FOR A NEW SPARE IS PLANTED
IMPINW:		0	; NUMBER OF WORDS OF REGULAR MESSAGE
IMPIMS:		0	; MASK FOR CLEANING OUT LAST WORD OF REGULAR MESSAGE
IMPIPD:		0	; INPUT SIDE PUSHDOWN LIST
IMPIPL:		BLOCK INTPLN

; I-LEVEL GENERAL STORAGE
; IN IMPCHAN WE HAVE . . .
;	CONSZ IMP,IDONE!IEND
;	JRST IMPINT
;	CONSZ IMP,ODONE
;	JRST IMPOUT
;	CONSZ IMP,IMPERR
;	JRST IMPERB

IMPAC1:		0	; ACCUMULATOR STORAGE
IMPAC2:		0
IMPAC3:		0
IMPPID:		P1PID
IMPIDSP:	IBEGIN
IMPODSP:	OBEGIN
IMPECT:		0	; ERROR BIT COUNT DOWN
; STORAGE FOR CLOCK LEVEL WAIT ROUTINE

IMPCLW:		0	; -1 MEANS WE ARE WAITING FOR FREE STORAGE
IMPPDP:		0	; WHERE PUSHDOWN POINTER IS STORED WHILE WAITING
IMPFP:		0	; THIS IS STACK AS IT LOOKS WHEN WE ENTER AT IMPCLK
IMPSAV:		BLOCK CLKPLN
			; WHERE CLOCK LEVEL PUSHDOWN LIST IS STORED WHILE WAITING

; STORAGE FOR CLOCK COUNTING SYSTEM TIMEOUTS

TIMCNT:		0	; COUNT DOWN FOR CHECKING TIMED WAITS
TIMWAIT:	0	; NUMBER OF PEOPLE WAITING FOR A TIMEOUT

; STORAGE FOR FREE STORAGE MANAGER

IMPFSL:		0	; FREE STORAGE LIST
IMPSPN:		0	; COUNT OF NUMBER OF SPARE BLOCKS NEEDED

; STORAGE FOR POLLING ROUTINE

POLTIM←←30*JIFSEC	; 60 MINUTES BETWEEN POLLS
POLCNT:		POLTIM

; FOR CLEANUP ROUTINE (ACTUALLY PART OF POLLING ROUTINE)

HCLSTM←←6		; 3 MINUTES BETWEEN CLEANUPS
HCLSCT:		0	; COUNTER FOR CLEANUPS

; OTHER STORAGE . . .

RECOVER:	0	; FLAG FOR ERROR RECOVERY SYSTEM
IMPPMS:		0	; SET ≠ 0 TO PRINT ALL ERROR MESSAGES
RSTHST:		377	; HOST TO BE RESET NEXT

NOPCNT:		4	;COUNT OF NOPS YET TO BE SENT TO IMP TO INITIALIZE
; HOST AND LINK TABLES

; STORAGE FOR ROUTINE THAT ASSIGNS NEW AND UNIQUE LINKS

LSTLNK:		0	; LAST LINK NUMBER ASSIGNED

; HOST TABLES AND LINK TABLE

L0WAIT:	0		; COUNT OF NUMBER OF JOBS IN IO WAIT FOR LINK 0 TO BECOME UNBLOCKED
L0CWTL:	0		; LIST OF MESSAGES INITIATED AT CLOCK LEVEL FOR LINK 0
SYSTBS←←.		; BEGINNING OF SYSTEM DATA TABLES
L0BLOK:	BLOCK 10	; BLOCKED-LINK-0 BIT FOR EACH HOST, 32. BITS PER WORD

MAXNLK←←40		; CURRENT MAXIMUM NUMBER OF CONNECTIONS
LNKMAX:	MAXNLK		; FOR THE SYSTEM TABLE READERS
LNKTAB:	BLOCK MAXNLK	; BITS 28-35 ARE LINK NUMBER, 20-27 ARE HOST NUMBER
IMPDDB:	BLOCK MAXNLK	; CONTAINS ADDRESS OF DDB ON THIS CONNECTION
IMPLS:	BLOCK MAXNLK	; LOCAL NUMBER
IMPFS:	BLOCK MAXNLK	; FOREIGN SOCKET
IMPBS:	BLOCK MAXNLK	; CONNECTION BYTE SIZE
IMPSTB:	BLOCK MAXNLK	; STATUS BIT TABLE
IMPRFQ:	BLOCK MAXNLK	; LIST OF RFCS WAITING FOR CONNECTION ON THIS SOCKET
FFLNK:	0		; INDEX OF FIRST FREE LINK.
; THE FOLLOWING ARE COUNTERS OF THE NUMBER OF TIMES VARIOUS EVENTS HAVE HAPPENED

FRMIMP:	0	; NUMBER OF MESSAGES FROM IMP
FLNOPS:	0	; NUMBER OF NO-OPS RECEIVED
TRACES:	0	; TRACE MESSAGES
ERWOMI:	0	; ERRORS WITHOUT MASSAGE IDENTIFICATION
NIMPDN:	0	; NUMBER OF IMP GOING DOWN MESSAGES
NBLNKS:	0	; BLOCKED LINK
LTFULL:	0	; LINK TABLE FULL
ERWMI:	0	; ERROR WITH MASSAGE IDENTIFICATION
INCMTR:	0	; INCOMPLETE TRANSMISSION
ILLMT:	0	; ILLEGAL MESSAGE TYPE
BDRFNM:	0	; RFNM RECEIVED ON AN UNBLOCKED LINK
NODDBS:	0	; NO DDB WHEN ONE WAS CALLED FOR
UNKLNK:	0	; NUMBER OF MESSAGES TO A NON-EX LINK
NRFNL:	0	; NUMBER OF RFNMS WITH NO LINK IN LINK TABLE
NILLOP:	0	; ILLEGAL SECOND LEVEL PROTOCAL OP CODE
BSILL:	0	; BYTE SIZE FOR SECOND LEVEL COMMAND ILLEGAL
BCMM:	0	; BYTE COUNT TOO SMALL FOR SECOND LEVEL COMMAND
RERRM:	0	; NUMBER OF ERROR MESSAGE WE HAVE RECEIVED
SPRRP:	0	; RESET REPLY WITH NO RESET GIVEN
N2RFCS:	0	; NUMBER OF TIMES TWO RFCS FROM THE SAME HOST WERE RECEIVED
NNOCLS:	0	; NUMBER OF TIMES NO CLOSE WAS SENT WHEN ONE WAS RECEIVED
NILLST:	0	; NUMBER OF TIMES THE TABLES WERE IN AN ILLEGAL STATE
NNCOR:	0	; NUMBER OF TIMES WE DIDN'T HAVE ANY FREE STORAGE AT UUO LEVEL
NNOCLW:	0	; NUMBER OF TIMES WE DIDN'T ACKNOWLEDGE A CLS
NOLKS:	0	; NUMBER OF TIMES WE COULDN'T ASSIGN A LINK NUMBER
NHOST0:	0	; NUMBER OF TIMES WE GOT A MESSAGE FOR HOST ZERO
SLNOPS:	0	; NUMBER OF SECOND LEVEL NO-OPS RECEIVED
NHANGS:	0	; INPUT STOPPED DUE TO LACK OF FREE STORAGE
NDPBLK:	0	; NUMBER OF TIMES WE TRIED TO STEAL F.S. FROM DPYSER
NSPSUS:	0	; SPARE F.S. BLOCKS WE USED
NRSETS:	0	; NUMBER OF RESETS WE HAVE RECEIVED
NMESIN:	0	; MESSAGES RECEIVED
NMESOU:	0	; MESSAGES SENT
NNOLNK:	0	; WE RAN OUT OF TABLE SPACE
NSCLSS:	0	; NUMBER OF UNSOLICITED CLSS WE RECEIVED
NOPADB:	0	; NO PADDING BIT FOUND
OPTMO:	0	; NUMBER OF TIMES THE INTERFACE TIMED OUT
IERBIT:	0	; NUMBER OF TIMES THE IMP ERROR BIT CAME UP
SLUNLK:	0	; SECOND-LEVEL UNKNOWN LINKS.
RWNOSS:	0	; REGULAR MESSAGE WITH NO SEND OR RECEIVE SOCKET
NIWCNO:	0	; NUMBER OF INPUTS (REGULAR MESSAGES) WITHOUT CONNECTION OPEN
NSSC:	0	; NUMBER OF REGULAR MESSAGES FOR CLOSED SOCKET
NALWNC:	0	; NUMBER OF ALLOCATES FOR UNCONNECTED LINK

IMPEND←←.		; END OF AREA CLEARED AT INITIALIZE TIME
